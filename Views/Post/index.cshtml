@using Markdig;
<link rel="stylesheet" href="~/css/post.css" />

@{
  ViewData["Title"] = Model.Title;
  ViewData["Url"] = $"{Config.Domain}/post/{Uri.EscapeDataString(Model.Title)}";
  ViewData["Image"] = $"{Config.Domain}/post/{Uri.EscapeDataString(Model.Title)}/{Model.Poster}";
}

@if(!string.IsNullOrEmpty(Model.Poster)){
<div class="hero">
    <img class="full-screen-width" src=@(Uri.EscapeDataString(Model.Title)+"/"+Model.Poster) alt="Banner Image">
    <div class="hero-text">
        <h1>@Model.Title</h1>
    </div>
 </div>
 <div class="center date">
    <p>@Model.Date?.ToString("D")</p>
 </div>
}
<button id="shareButton">share</button>
<script>
    shareButton.addEventListener("click", onShare);
    async function onShare() {
        const title = document.title;
        const url = document.querySelector("link[rel=canonical]")
            ? document.querySelector("link[rel=canonical]").href
            : document.location.href;
        const text = "Share this blog post";
        try {
            await navigator
            .share({
                title,
                url,
                text
            })
                /*
                Show a message if the user shares something
                */
            } catch (err) {
            /*
                This error will appear if the user cancels the action of sharing.
                */
            }
    }
</script>




@if (Config.Password != null && !User.Identity.IsAuthenticated)
{
<div  class="center" style="margin-bottom:8vh">
    <h1>Members only</h1>
    <p>You have to login to view the content of this page.</p>
    <button class="bnt-black" onclick="location.href='/login?ReturnUrl=/post/@Model.Title'" type="button">Login</button>
</div>
return;
}

<div>
    @{
     var pipeline = new MarkdownPipelineBuilder().UseYamlFrontMatter().UseAdvancedExtensions().Build();
     var html = Markdown.ToHtml(Model.Markdown, pipeline);
     html = html.Replace("<p><img src=\"", $"<p><img src=\"{Model.Title}/");
     html = html.Replace($"{Model.Title}/https://", "https://");
     html = html.Replace($"{Model.Title}/http://", "http://");
    }
    @Html.Raw(html)
</div>

<div class="center">
    <a href="#top">
        <img style="height: 3vw;" src="/icon/arrow_up.svg">
    </a>
</div>
